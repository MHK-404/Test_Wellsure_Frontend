<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Insurance Risk Assessment</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ... (keep all existing styles the same) ... */
  </style>
</head>
<body>
  <h1><i class="fas fa-shield-alt"></i> Insurance Risk Assessment</h1>
  <form id="riskForm">
    <fieldset class="personal-info">
      <legend>Personal Information</legend>
      
      <div class="form-group">
        <label>Age <span class="help-tip" data-tooltip="Please enter your current age in years">?</span></label>
        <input type="number" name="age" min="18" max="100" required>
      </div>
      
      <div class="form-group">
        <label>Gender</label>
        <select name="gender">
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
          <option>Prefer not to say</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Marital Status</label>
        <select name="marital">
          <option>Single</option>
          <option>Married</option>
          <option>Divorced</option>
          <option>Widowed</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Occupation Type</label>
        <select name="occupation">
          <option>Sedentary (mostly sitting)</option>
          <option>Light Activity (some walking)</option>
          <option>Moderately Active (regular movement)</option>
          <option>Very Active (physically demanding)</option>
          <option>Extremely Active (heavy labor)</option>
        </select>
      </div>
    </fieldset>

    <fieldset class="physical-health">
      <legend>Physical Health</legend>
      
      <div class="form-group">
        <label>Do you smoke? <span class="help-tip" data-tooltip="Includes cigarettes, cigars, pipes, or vaping">?</span></label>
        <select name="smoke">
          <option>No</option>
          <option>Yes, occasionally</option>
          <option>Yes, regularly</option>
          <option>Former smoker</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>If you smoke, how many per day?</label>
        <select name="smokeAmount" class="conditional-question">
          <option>Less than 5</option>
          <option>5-10</option>
          <option>10-20</option>
          <option>More than 20</option>
        </select>
      </div>
      
      <!-- Removed alcohol question -->
      
      <div class="form-group">
        <label>Chronic Conditions <span class="help-tip" data-tooltip="Select all that apply to you">?</span></label>
        <div class="checkbox-group">
          <label><input type="checkbox" name="conditions" value="diabetes"> Diabetes</label>
          <label><input type="checkbox" name="conditions" value="hypertension"> Hypertension</label>
          <label><input type="checkbox" name="conditions" value="asthma"> Asthma</label>
          <label><input type="checkbox" name="conditions" value="cholesterol"> High Cholesterol</label>
          <label><input type="checkbox" name="conditions" value="heart"> Heart Disease</label>
          <label><input type="checkbox" name="conditions" value="arthritis"> Arthritis</label>
          <label><input type="checkbox" name="conditions" value="none"> None</label>
        </div>
      </div>
      
      <div class="form-group">
        <label>Height (cm)</label>
        <input type="number" name="height" min="100" max="250">
      </div>
      
      <div class="form-group">
        <label>Weight (kg)</label>
        <input type="number" name="weight" min="30" max="200">
      </div>
      
      <div class="form-group">
        <label>How often do you exercise?</label>
        <select name="exercise">
          <option>Never</option>
          <option>Rarely (less than once a week)</option>
          <option>1-2 times per week</option>
          <option>3-4 times per week</option>
          <option>5 or more times per week</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Type of exercise you do most often</label>
        <select name="exerciseType">
          <option>None</option>
          <option>Walking</option>
          <option>Running/Jogging</option>
          <option>Cycling</option>
          <option>Swimming</option>
          <option>Weight Training</option>
          <option>Yoga/Pilates</option>
          <option>Team Sports</option>
          <option>Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Average hours of sleep per night</label>
        <select name="sleep">
          <option>Less than 5</option>
          <option>5-6</option>
          <option>6-7</option>
          <option>7-8</option>
          <option>More than 8</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>How would you rate your diet?</label>
        <select name="diet">
          <option>Poor (mostly processed foods)</option>
          <option>Fair (some healthy choices)</option>
          <option>Good (balanced diet)</option>
          <option>Excellent (mostly whole foods, balanced)</option>
        </select>
      </div>
    </fieldset>

    <!-- ... (keep rest of the form fields the same) ... -->

    <button type="submit" class="submit-btn">Submit Assessment <i class="fas fa-arrow-right"></i></button>
  </form>

  <div class="result-container" id="resultContainer">
    <!-- ... (keep result container HTML the same) ... -->
  </div>

  <script>
    // Show conditional question based on smoking status
    document.querySelector('select[name="smoke"]').addEventListener('change', function() {
      const smokeAmountField = document.querySelector('select[name="smokeAmount"]');
      if (this.value.includes("Yes")) {
        smokeAmountField.style.display = 'block';
        smokeAmountField.setAttribute('required', '');
      } else {
        smokeAmountField.style.display = 'none';
        smokeAmountField.removeAttribute('required');
      }
    });
    
    // Form submission handler
    document.getElementById('riskForm').addEventListener('submit', async function(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());
      
      // Show loading state
      const submitBtn = document.querySelector('.submit-btn');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      submitBtn.disabled = true;
      
      try {
        const response = await fetch('https://test-wellsure-back-ancbame0gwg5ccfu.uaenorth-01.azurewebsites.net/assess', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        displayResults(result);
      } catch (error) {
        console.error('Submission failed:', error);
        document.getElementById('resultContainer').style.display = 'block';
        document.getElementById('riskLevel').className = 'risk-level';
        document.getElementById('riskLevel').innerHTML = 'Error: Unable to process your assessment. Please try again later.';
      } finally {
        submitBtn.innerHTML = 'Submit Assessment <i class="fas fa-arrow-right"></i>';
        submitBtn.disabled = false;
      }
    });
    
    // Display results function
    function displayResults(result) {
      const resultContainer = document.getElementById('resultContainer');
      const riskLevelElement = document.getElementById('riskLevel');
      const recommendationsList = document.getElementById('recommendationsList');
      
      // Show result container
      resultContainer.style.display = 'block';
      
      // Set risk level
      riskLevelElement.textContent = `Your Risk Level: ${result.riskCategory}`;
      
      // Apply appropriate class based on risk level
      if (result.riskCategory.toLowerCase().includes('low')) {
        riskLevelElement.className = 'risk-level risk-low';
      } else if (result.riskCategory.toLowerCase().includes('moderate')) {
        riskLevelElement.className = 'risk-level risk-moderate';
      } else {
        riskLevelElement.className = 'risk-level risk-high';
      }
      
      // Update dashboard scores
      document.getElementById('physicalScore').textContent = result.physicalScore || '75';
      document.getElementById('mentalScore').textContent = result.mentalScore || '60';
      document.getElementById('lifestyleScore').textContent = result.lifestyleScore || '80';
      
      // Update progress bars
      document.querySelector('#physicalBar div').style.width = (result.physicalScore || 75) + '%';
      document.querySelector('#mentalBar div').style.width = (result.mentalScore || 60) + '%';
      document.querySelector('#lifestyleBar div').style.width = (result.lifestyleScore || 80) + '%';
      
      // Format recommendations
      if (result.recommendations) {
        const recommendations = Array.isArray(result.recommendations) 
          ? result.recommendations 
          : result.recommendations.split('\n');
        
        recommendationsList.innerHTML = '<ul>' + 
          recommendations.map(rec => `<li>${rec}</li>`).join('') + 
          '</ul>';
      } else {
        recommendationsList.innerHTML = '<p>No specific recommendations available.</p>';
      }
    }
    
    // PDF button handler - using jsPDF library
    document.getElementById('pdfBtn').addEventListener('click', function() {
      // Load jsPDF library dynamically
      const script = document.createElement('script');
      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
      script.onload = function() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Get form data
        const formData = new FormData(document.getElementById('riskForm'));
        const data = Object.fromEntries(formData.entries());
        
        // Get results
        const riskLevel = document.getElementById('riskLevel').textContent;
        const recommendations = document.getElementById('recommendationsList').textContent;
        
        // Create PDF content
        doc.setFontSize(18);
        doc.text('Insurance Risk Assessment Report', 105, 20, { align: 'center' });
        
        doc.setFontSize(12);
        doc.text('Personal Information:', 14, 40);
        doc.text(`Age: ${data.age || 'N/A'}`, 14, 50);
        doc.text(`Gender: ${data.gender || 'N/A'}`, 14, 60);
        doc.text(`Marital Status: ${data.marital || 'N/A'}`, 14, 70);
        
        doc.text('Health Assessment Results:', 14, 90);
        doc.text(riskLevel, 14, 100);
        
        doc.text('Recommendations:', 14, 120);
        const splitText = doc.splitTextToSize(recommendations, 180);
        doc.text(splitText, 14, 130);
        
        // Add current date
        const today = new Date();
        doc.text(`Report generated on: ${today.toLocaleDateString()}`, 14, 280);
        
        // Save the PDF
        doc.save('Risk_Assessment_Report.pdf');
      };
      document.head.appendChild(script);
    });
  </script>
</body>
</html>
